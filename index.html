<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="UTF-8">
<title>CONTROL ACP V15</title>
<script src=""></script>
<style>
:root { --primary: #1e293b; --accent: #3b82f6; --diesel: #2563eb; --gasohol: #10b981; --danger: #ef4444; --warning: #f59e0b; --success: #059669; }
body { font-family: 'Segoe UI', sans-serif; background: #f1f5f9; margin: 0; padding: 20px; }
.dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; max-width: 1350px; margin: auto; }
.card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-top: 5px solid var(--accent); }
.full-width { grid-column: span 2; }
.btn { cursor: pointer; padding: 12px; border: none; border-radius: 6px; font-weight: bold; color: white; transition: 0.2s; text-align: center; }
.btn-blue { background: var(--accent); width: 100%; margin-top: 10px; }
.btn-sim { background: #6366f1; }
.monitor-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
.stock-box { padding: 15px; border-radius: 10px; text-align: center; background: #f8fafc; border: 3px solid #e2e8f0; transition: 0.5s; }
.stock-label { font-size: 2.2rem; font-weight: 800; display: block; margin: 5px 0; }
.autonomia-ok { border-color: var(--success) !important; background: #f0fdf4 !important; }
.autonomia-alerta { border-color: var(--warning) !important; background: #fffbeb !important; }
.autonomia-critica { border-color: var(--danger) !important; background: #fee2e2 !important; animation: blink 1.5s infinite; }
@keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }
table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9em; }
th, td { padding: 10px; text-align: left; border-bottom: 1px solid #e2e8f0; }
.status-badge { padding: 4px 8px; border-radius: 4px; color: white; font-weight: bold; font-size: 0.8em; }
.bg-success { background: var(--success); } .bg-warning { background: var(--warning); } .bg-danger { background: var(--danger); }
.modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background: rgba(15,23,42,0.8); backdrop-filter: blur(4px); }
.modal-content { background: white; margin: 2% auto; padding: 25px; width: 90%; max-width: 750px; border-radius: 15px; }
.sim-card { background: #f1f5f9; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
input, select { padding: 12px; border: 1px solid #cbd5e1; border-radius: 6px; width: 100%; margin-bottom: 10px; }
</style>
</head>
<body>
<div class="dashboard">
<div class="card full-width" style="background: var(--primary); color: white; display:flex; justify-content:space-between; align-items:center; border:none;">
<div><h2 style="margin:0">‚õΩ Control Grupo ACP - Gesti√≥n Operativa</h2><small id="statusCloud">Cargando...</small></div>
<div style="display:flex; gap:10px;">
<button onclick="abrirSimulador()" class="btn btn-sim">üìä Simulador</button>
<button onclick="exportarExcel()" class="btn" style="background:#107c41">üì• Excel</button>
</div>
</div>
<div class="card">
<h3>üìù Registro</h3>
<select id="tipoMov" onchange="toggleCisterna()"><option value="salida">Salida</option><option value="ingreso">Ingreso</option></select>
<select id="prod"><option value="DIESEL">Diesel</option><option value="GASOHOL">Gasohol</option></select>
<input type="number" id="cant" step="0.01" placeholder="Cantidad gl">
<div id="extraData" style="display:none;"><input type="text" id="referencia" placeholder="Placa / Factura"></div>
<button id="btnGuardar" class="btn btn-blue" onclick="procesarMovimiento()">Guardar</button>
</div>
<div class="card">
<h3>üöö Monitor Stock (Ciclos 24h)</h3>
<div class="monitor-grid">
<div id="boxD" class="stock-box"><b>Diesel</b><span id="sDiesel" class="stock-label" style="color:var(--diesel)">0.00</span><span id="autD" style="background:var(--primary); color:white; padding:2px 6px; border-radius:4px; font-size:0.8em;">---</span></div>
<div id="boxG" class="stock-box"><b>Gasohol</b><span id="sGasohol" class="stock-label" style="color:var(--gasohol)">0.00</span><span id="autG" style="background:var(--primary); color:white; padding:2px 6px; border-radius:4px; font-size:0.8em;">---</span></div>
</div>
</div>
<div class="card full-width">
<h3>üõ† Plan de Mantenimiento</h3>
<table>
<thead><tr><th>Equipo</th><th>Filtro</th><th>Fecha</th><th>D√≠as</th><th>Estado</th><th>Acci√≥n</th></tr></thead>
<tbody id="mantoBody"></tbody>
</table>
</div>
<div class="card full-width">
<h3>üìù Historial Reciente</h3>
<table>
<thead><tr><th>Fecha</th><th>Mov</th><th>Prod</th><th>Cant</th><th>Saldo</th></tr></thead>
<tbody id="historialBody"></tbody>
</table>
</div>
</div>
<div id="modalSimulador" class="modal">
<div class="modal-content">
<div style="display:flex; justify-content:space-between;"><h2>üìä Planificaci√≥n Pedido</h2><button onclick="cerrarSimulador()" style="border:none; background:none; font-size:1.5rem; cursor:pointer;">‚úï</button></div>
<div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin:15px 0;">
<div class="sim-card"><b>Consumo Diario</b>


Diesel: 1,700 gl


Gasohol: 165 gl</div>
<div class="sim-card" style="background:#e0f2fe;"><b>Autonom√≠a</b>


Diesel: <span id="dD">0</span> ciclos


Gasohol: <span id="dG">0</span> d√≠as</div>
</div>
<div class="sim-card" style="border:2px solid var(--accent); background:#f8fafc;">
<h3>üõí An√°lisis Operativo</h3>
<p id="analisisTexto" style="font-size:0.95em; line-height:1.4;"></p>
<label>Diesel a pedir:</label><input type="number" id="pedD">
<label>Gasohol a pedir:</label><input type="number" id="pedG">
<button onclick="enviarPedidoCorreo()" class="btn" style="background:var(--success); width:100%;">üìß Enviar Pedido (3,000 gl)</button>
<p id="envioStatus" style="text-align:center; font-weight:bold; margin-top:10px;"></p>
</div>
</div>
</div>
<script>
const URL_GOOGLE_SHEETS = '';
let db = { stockFuel: { diesel: 0, gasohol: 0 }, historial: [], equipos: [{ id: 'Surtidor 1 Diesel', f: 'CF60', ult: '2026-01-15' }, { id: 'Surtidor 2 Diesel', f: 'CF60', ult: '2026-01-23' }, { id: 'Hipotanque (M√≥vil)', f: 'CF100', ult: '2025-12-10' }, { id: 'Surtidor Gasohol', f: 'MALLA', ult: '2026-01-15' }] };
async function cargarDatosDesdeNube() {
try {
const res = await fetch(URL_GOOGLE_SHEETS + '?t=' + new Date().getTime());
const data = await res.json();
db.stockFuel.diesel = parseFloat(data.ultimoDiesel);
db.stockFuel.gasohol = parseFloat(data.ultimoGasohol);
db.historial = data.historialNube || [];
actualizarUI();
document.getElementById('statusCloud').innerText = "‚úÖ Sincronizado";
} catch (e) { document.getElementById('statusCloud').innerText = "‚ö†Ô∏è Error de red"; }
}
function actualizarUI() {
const pD = 1700; const pG = 165;
const ad = (db.stockFuel.diesel / pD).toFixed(1);
const ag = (db.stockFuel.gasohol / pG).toFixed(1);
document.getElementById('sDiesel').innerText = db.stockFuel.diesel.toFixed(2);
document.getElementById('sGasohol').innerText = db.stockFuel.gasohol.toFixed(2);
document.getElementById('autD').innerText = ad + " d√≠as";
document.getElementById('autG').innerText = ag + " d√≠as";
const boxD = document.getElementById('boxD'); boxD.className = 'stock-box';
if(ad < 1.0) boxD.classList.add('autonomia-critica');
else if(ad < 2.0) boxD.classList.add('autonomia-alerta');
else boxD.classList.add('autonomia-ok');
const hoy = new Date();
document.getElementById('mantoBody').innerHTML = db.equipos.map((e, i) => {
const diff = Math.floor((hoy - new Date(e.ult)) / (10006060*24));
let c = diff >= 90 ? "bg-danger" : (diff >= 80 ? "bg-warning" : "bg-success");
return &lt;tr&gt;&lt;td&gt;&lt;b&gt;${e.id}&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&lt;code&gt;${e.f}&lt;/code&gt;&lt;/td&gt;&lt;td&gt;${e.ult}&lt;/td&gt;&lt;td&gt;${diff} d&lt;/td&gt;&lt;td&gt;&lt;span class=&quot;status-badge ${c}&quot;&gt;${diff&gt;=90?&#39;VENCIDO&#39;:&#39;OK&#39;}&lt;/span&gt;&lt;/td&gt;&lt;td&gt;&lt;button class=&quot;btn btn-blue&quot; style=&quot;padding:5px 10px; margin:0; width:auto;&quot; onclick=&quot;hacerManto(${i})&quot;&gt;Reset&lt;/button&gt;&lt;/td&gt;&lt;/tr&gt;;
}).join('');
document.getElementById('historialBody').innerHTML = db.historial.slice(0, 10).map(h => &lt;tr&gt;&lt;td&gt;${h.fecha}&lt;/td&gt;&lt;td&gt;&lt;b&gt;${h.mov}&lt;/b&gt;&lt;/td&gt;&lt;td&gt;${h.prod}&lt;/td&gt;&lt;td&gt;${h.cant}&lt;/td&gt;&lt;td&gt;&lt;b&gt;${h.saldo}&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;).join('');
}
function procesarMovimiento() {
const btn = document.getElementById('btnGuardar');
const mov = document.getElementById('tipoMov').value.toUpperCase();
const prod = document.getElementById('prod').value;
const cant = parseFloat(document.getElementById('cant').value);
const ref = document.getElementById('referencia').value || "DESPACHO";
if (!cant || cant <= 0) return alert("Cantidad inv√°lida");
let nD = db.stockFuel.diesel; let nG = db.stockFuel.gasohol;
if (prod === 'DIESEL') nD = (mov === 'SALIDA') ? nD - cant : nD + cant;
else nG = (mov === 'SALIDA') ? nG - cant : nG + cant;
btn.disabled = true;
fetch(URL_GOOGLE_SHEETS, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ tipo: mov, producto: prod, cantidad: cant, responsable: ref.toUpperCase(), stockDiesel: nD.toFixed(2), stockGasohol: nG.toFixed(2) }) }).then(() => { db.stockFuel.diesel = nD; db.stockFuel.gasohol = nG; actualizarUI(); setTimeout(() => { cargarDatosDesdeNube(); btn.disabled = false; document.getElementById('cant').value = ""; }, 1500); });
}
function abrirSimulador() {
document.getElementById('modalSimulador').style.display = 'block';
const sD = db.stockFuel.diesel; const c = 1700;
const autoD = (sD / c).toFixed(1);
document.getElementById('dD').innerText = autoD;
document.getElementById('dG').innerText = (db.stockFuel.gasohol / 165).toFixed(1);
let sug = sD < 3400 ? 3000 : 0;
document.getElementById('analisisTexto').innerHTML = sug > 0 ? ‚ö†Ô∏è Stock actual (${sD.toFixed(0)} gl) bajo. Despu√©s de los turnos de hoy quedar√°s con ${(sD-c).toFixed(0)} gl. &lt;b&gt;Pedir 3,000 gl hoy.&lt;/b&gt; : "‚úÖ Stock seguro para las pr√≥ximas 24h.";
document.getElementById('pedD').value = sug;
}
function enviarPedidoCorreo() {
const d = document.getElementById('pedD').value;
const g = document.getElementById('pedG').value;
const s = document.getElementById('envioStatus');
if(!d && !g) return alert("Ingrese cantidades");
s.innerText = "‚è≥ Enviando orden..."; s.style.color = "blue";
fetch(URL_GOOGLE_SHEETS, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ tipo: "PEDIDO_SIMULADO", cantidadDiesel: d, cantidadGasohol: g, actualD: db.stockFuel.diesel, actualG: db.stockFuel.gasohol }) }).then(() => { s.innerText = "‚úÖ Pedido enviado"; setTimeout(() => { s.innerText = ""; cerrarSimulador(); }, 2500); });
}
function exportarExcel() {
if (db.historial.length === 0) return alert("No hay datos");
const ws = XLSX.utils.json_to_sheet(db.historial.map(h => ({ FECHA: h.fecha, MOV: h.mov, PROD: h.prod, CANT: h.cant, REF: h.ref, SALDO: h.saldo })));
const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "Historial");
XLSX.writeFile(wb, Reporte_ACP_${new Date().toLocaleDateString()}.xlsx);
}
function cerrarSimulador() { document.getElementById('modalSimulador').style.display = 'none'; }
function toggleCisterna() { document.getElementById('extraData').style.display = (document.getElementById('tipoMov').value === 'ingreso') ? 'block' : 'none'; }
function hacerManto(i) { db.equipos[i].ult = new Date().toISOString().split('T')[0]; actualizarUI(); }
cargarDatosDesdeNube();
setInterval(cargarDatosDesdeNube, 30000);
</script>
</body>
</html>
